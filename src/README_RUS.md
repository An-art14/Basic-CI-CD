# Basic CI/CD

Разработка простого **CI/CD** для проекта *SimpleBashUtils*. Сборка, тестирование, развертывание.


## Содержание

1. Введение
    - основы CICD
    - основы CI
    - основы CD
2. Настройка gitlab-runner
3. Сборка
4. Тест кодстайла  
5. Интеграционные тесты
6. Этап деплоя
7. Уведомления

## Ввведение 
### Основы **CI/CD**

**CI/CD** — Это набор принципов и практик, которые позволяют чаще и надежнее развертывать изменения программного обеспечения.

Причины применения **CI/CD**:
- Командная разработка;
- Длинный жизненный цикл ПО;
- Сокращение релизного цикла;
- Сложность развертывания и тестирования крупных систем;
- Человеческий фактор.

**CI/CD** pipeline - Это последовательность действий (скриптов) для определенной версии кода в репозитории, которая запускается автоматически при совершении изменений.

### Основы **CI**

**CI** (Continuous Integration) — в дословном переводе «непрерывная интеграция».
Имеется в виду интеграция отдельных кусочков кода приложения между собой.
**CI** обычно выполняет две задачи, описанные далее.

- BUILD
    - Проверяем, собирается ли вообще код;
    - Готовим артефакты для следующих стадий;

- TEST
    - Тесты кодстайла;
    - Модульные тесты;
    - Интеграционные тесты;
    - Прочие тесты, которые у тебя есть;
    - Отчеты о тестах.

### Основы **CD**

**CD** (Continuous Delivery) — это расширение непрерывной интеграции, поскольку оно автоматически развертывает все изменения кода в тестовой и/или производственной среде после этапа сборки.
**CD** может выполнять задачи, описанные далее.

- PUBLISH (В случае применения докера для развёртывания):
    - Собираем образы контейнеров;
    - Пушим образы туда, откуда их будем потом брать для развертывания;
- UPDATE CONFIGS:
    - Обновляем конфигурацию на машинах;
- DEPLOY STAGING:
    - Развертывание тестовой среды для ручных тестов, QA, и прочих не автоматизируемых проверок;
    - Может запускаться как вручную, так и автоматически при успешном прохождении стадий CI;
- DEPLOY PRODUCTION:
    - Разворачиваем новую версию системы на «продакшн»;
    - Этот этап желательно запускать вручную, а не автоматически;
    - По желанию можно настроить только для определенной ветки репозитория (master, release и т.п.).


###  Настройка **gitlab-runner**

##### 1. Поднятие  виртуальной машины *Ubuntu Server 22.04 LTS* (с сохранинием дампа образа виртуальной машины)

##### 2. Установка на виртуальную машину **gitlab-runner**.

##### 3. Запуск **gitlab-runner** и регистрирация его для использования в текущем проекте (*DO6_CICD*).


###  Сборка


#### 1. Этап для **CI** по сборке приложений из проекта *C2_SimpleBashUtils*.

##### 2. В файле _gitlab-ci.yml_ добален этап запуска сборки через мейк файл из проекта _C2_.

##### 3. Файлы, полученные после сборки (артефакты), хранятся в течение 30 дней.


###  Тест кодстайла

#### 1. Написан этап для **CI**, который запускает скрипт кодстайла (*clang-format*).

##### 2. В пайплайне отображается вывод утилиты *clang-format*.


###  Интеграционные тесты

#### 1. Написан этап для **CI**, который запускает твои интеграционные тесты из того же проекта.

##### 2. Этап запуска осуществляется автоматически только при условии, если сборка и тест кодстайла прошли успешно.

##### 3. В пайплайне отображается вывод, что интеграционные тесты успешно прошли / провалились.


###  Этап деплоя

##### 1. Поднятие  второй виртуальной машины *Ubuntu Server 22.04 LTS*.

#### 2. Написан этап для **CD**, который «разворачивает» проект на другой виртуальной машине.

##### 3. Запуск этого этапа происходит вручную при условии, что все предыдущие этапы прошли успешно.

#####  4. Написан bash-скрипт, который при помощи **ssh** и **scp** копирует файлы, полученные после сборки (артефакты), в директорию */usr/local/bin* второй виртуальной машины.

##### 5. В файле _gitlab-ci.yml_ добавлен этап запуска написанного скрипта.

В результате получены готовые к работе приложения из проекта *C2_SimpleBashUtils* (s21_cat и s21_grep) на второй виртуальной машине.

#####  6. Сохранение дампов образов виртуальных машин.

###  Уведомления

#####  Настроены уведомления о успешном/неуспешном выполнении пайплайна через бота с именем «[nickname] DO6 CI/CD» в *Telegram*.

- Текст уведомления содержит информацию об успешности прохождения как этапа **CI**, так и этапа **CD**.
